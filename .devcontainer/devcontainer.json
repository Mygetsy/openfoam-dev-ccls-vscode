{
    "name": "OpenFOAM Dev Container for VS Code (ccls + Bear)",
    "image": "mygetsy/openfoam-dev-ccls:v2406", // Change this to suitable version e.g 13 for ORG or v2506 for COM. Note "v" in the version name.
    "customizations": {
        "vscode": {
            "extensions": [
                "ccls-project.ccls",
                "vadimcn.vscode-lldb"
            ],
            "settings": {
                // Point ccls to your compile_commands.json
                "ccls.misc.compilationDatabaseDirectory": "/home/openfoam/workspace/",

                // 1. Point ccls to the MOUNTED volume (the unified cache)
                "ccls.cache.directory": "/home/openfoam/.ccls-cache",

                // Performance settings
                "ccls.index.threads": 4,
                "C_Cpp.intelliSenseEngine": "disabled",
                "terminal.integrated.defaultProfile.linux": "bash"
            }
        }
    },
    "remoteUser": "openfoam",
    "updateRemoteUserUID": true,
    "runArgs": [
        "--cap-add=SYS_PTRACE",
        "--security-opt", "seccomp=unconfined",
        "--name", "meltpoolfoam-plus-dev"
    ],
    "workspaceMount": "source=${localWorkspaceFolder},target=/home/openfoam/workspace,type=bind,consistency=cached",
    "workspaceFolder": "/home/openfoam/workspace",

    "mounts": [
        "source=bashhistory-meltpool,target=/commandhistory,type=volume",
        // 2. This volume will hold your local index + SYMLINKS to the system index
        "source=ccls-cache-meltpool,target=/home/openfoam/.ccls-cache,type=volume"
    ],

    // 3. COMMAND: Recursively link system cache into local volume.
    // 'cp -rs' creates symlinks. The '.' at the end of the source path is critical.
    // We use '|| true' to ignore errors if links already exist.
    "postStartCommand": "mkdir -p /home/openfoam/.ccls-cache && if [ -d '/opt/openfoam/.ccls-cache' ]; then echo 'Linking system ccls cache...' && cp -rs /opt/openfoam/.ccls-cache/. /home/openfoam/.ccls-cache/ 2>/dev/null || true; fi"
}

